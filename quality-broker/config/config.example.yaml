# Save this to data/quality-broker/config/config.yaml
batchSize: 10
autoAssignProfile: AutoAssignQuality
decisionProfiles:
  - HD
  - Efficient-4K
  - HighQuality-4K

radarr:
  # URL auto-derives from LAN_HOSTNAME/RADARR_PORT (or radarr:7878 in Docker);
  # set this field only if you need a custom host.
  # url:
  apiKey: your-radarr-api-key

openai:
  apiKey: your-openai-api-key
  model: gpt-4-turbo

temperature: 0.3
maxTokens: 400

thresholds:
  criticScoreMin: 68
  popularityHigh: 80
  popularityLow: 10
  allowPopularityTierFallback: true
  popularityTierFallbackMaxPopularity: 2

releaseGroups:
  penalizeIfHighQuality4k: [ "YTS", "YIFY" ]
  preferIfHighQuality4k: [ "FLUX", "FraMeSToR", "Hallowed", "LAMA" ]

visualGenresHigh:
  - Action
  - Animation
  - Adventure
  - Sci-Fi
  - Fantasy
  - War
  - Thriller

policies:
  remux:
    enabled: true
    penaltyScore: -1000
    sizeCapMbPerMin: 1
    message: "Remux is fully blocked (score -1000, size cap 1MB/min). Do not pick remux or suggest it."
  reasoning:
    maxSentences: 2
    forbidCurrentTrendsClaims: true
    allowTimelessCulturalInference: true

promptHints: |
  - Use only provided fields and thresholds; do not claim "currently trending" or recent buzz.
  - Treat popularity as noisy/unbounded; very low values (0-2) often mean "no signal", not "unpopular".
  - Use voteCountReliable as a minimum for trusting popularity/rating as stable.
  - HighQuality-4K is only for visually rich titles where 4K/HDR/DV adds real value.
  - Efficient-4K is for 4K-worthy titles with moderate payoff; compact encodes acceptable.
  - HD is for low-signal titles where 4K adds little value.
  - If releaseGroup is penalized (YTS/YIFY) and HighQuality-4K would be chosen, prefer Efficient-4K unless visual payoff is exceptional.

reasonTags:
  popular: when upgrade reason is that film is popular / culturally significant
  criticScore: when upgrade reason is that film has a good critic score
  visual: when upgrade reason is that film is visually rich (action, animation, HDR/DV value)
  lowq: when current file quality is 720p or below
  met: when current file meets quality demands based on rules

promptTemplate:
  header: |
    You are a Radarr Quality Broker. Output ONLY valid JSON.

    REQUIRED JSON STRUCTURE (use these EXACT field names):
    {
      "profile": "string - one of the allowed profile names",
      "rules": ["string array - allowed reason tags"],
      "reasoning": "string - 1-2 sentences explaining why"
    }

    CRITICAL - USE THESE EXACT FIELD NAMES:
    - Field name is "profile" (NOT "autoAssignProfile", NOT "profileName")
    - Field name is "rules" (NOT "reason", NOT "reasonDescription", NOT "allowedReasons")
    - Field name is "reasoning" (NOT "reasonDescription", NOT "explanation", NOT "rationale")

    VALID EXAMPLE:
    {
      "profile": "HD",
      "rules": ["lowq", "criticScore"],
      "reasoning": "Current file is 720p. Critic score of 75 justifies HD upgrade."
    }

    INVALID EXAMPLES (DO NOT USE):
    {"autoAssignProfile": "HD", ...}  ❌ Wrong field name
    {"profile": "HD", "reason": "lowq", ...}  ❌ "reason" should be "rules" array
    {"profile": "HD", "rules": ["lowq"], "reasonDescription": "..."}  ❌ "reasonDescription" should be "reasoning"

  constraints: |
    FIELD REQUIREMENTS:
    1. "profile": REQUIRED string, must exactly match one of: allowedProfiles
    2. "rules": REQUIRED array of strings, each must be from: allowedReasons
    3. "reasoning": REQUIRED string, 1-2 sentences citing the data
    4. "popularityTier": OPTIONAL string ("low"|"mid"|"high"), only if popularityTierPolicy.allow is true

    JSON OUTPUT RULES:
    - Use ONLY the exact field names above
    - Do NOT add extra fields like "reasonDescription", "autoAssignProfile", "explanation"
    - Do NOT use markdown code blocks
    - Output pure JSON only

  inputs: |
    Decision inputs you will receive:
    - criticScore, popularity, tmdbVotes, genres, studio, runtime, currentQuality, mediaInfo, releaseGroup
    - thresholds, releaseGroups, visualGenresHigh, promptHints, policies

  popularityTierPolicy: |
    PopularityTier fallback policy:
    - popularityTierPolicy.allow indicates whether you may emit popularityTier.
    - If allow=true, infer TIMELESS cultural salience only from title/year/studio/genres/franchise archetypes.
    - Do NOT claim anything about current trends or recent buzz.

  groupsAndGenres: |
    Release group guidance:
    - Penalized groups for HighQuality-4K: {{penalizeGroups}}
    - Preferred groups for HighQuality-4K: {{preferGroups}}

    Visual richness guidance (for HighQuality-4K):
    - Visual-rich genres: {{visualGenresHigh}}

  remuxPolicy: |
    Remux policy: {{remuxPolicyMessage}}

# Save this to data/quality-broker/config/config.yaml
batchSize: 10
autoAssignProfile: AutoAssignQuality
decisionProfiles:
  - HD
  - Efficient-4K
  - HighQuality-4K

radarr:
  # URL auto-derives from LAN_HOSTNAME/RADARR_PORT (or radarr:7878 in Docker);
  # set this field only if you need a custom host.
  # url:
  apiKey: your-radarr-api-key

openai:
  apiKey: your-openai-api-key
  # Default: gpt-4.1 (supports json_schema structured outputs for stricter validation).
  # Rationale: maximize schema compliance and reduce malformed responses.
  model: gpt-4.1
  # Default: 0.15
  # Rationale: keep decisions consistent and grounded; higher values increase variance.
  temperature: 0.15
  # Default: 320
  # Rationale: enough for concise reasoning without encouraging verbosity.
  maxTokens: 320


thresholds:
  criticScoreMin: 68
  popularityHigh: 80
  popularityLow: 10
  allowPopularityTierFallback: true
  popularityTierFallbackMaxPopularity: 2
  voteCountReliable: 400
  voteCountHigh: 3000

visualGenresHigh:
  - Action
  - Animation
  - Adventure
  - Sci-Fi
  - Fantasy
  - War
  - Thriller

policies:
  reasoning:
    maxSentences: 2
    forbidCurrentTrendsClaims: true
    allowTimelessCulturalInference: true

promptHints: |
  - Use only provided fields and thresholds; do not claim "currently trending" or recent buzz.
  - Treat popularity as noisy/unbounded.
  - Use voteCountReliable as a minimum for trusting popularity/rating as stable.
  - If criticScore >= 84, choose HighQuality-4K regardless of genre signals.
  - HighQuality-4K is only for visually rich titles where 4K/HDR/DV adds real value.
  - Efficient-4K is for 4K-worthy titles with moderate payoff; compact encodes acceptable.
  - HD is for low-signal titles where 4K adds little value.

reasonTags:
  popular: when upgrade reason is that film is popular / culturally significant
  criticScore: when upgrade reason is that film has a good critic score
  visual: when upgrade reason is that film is visually rich (action, animation, HDR/DV value)
  lowq: when current file quality is 720p or below
  met: when current file meets quality demands based on rules

promptTemplate:
  prelude: |
    You are a Radarr quality profile decision agent. Respond ONLY with a single JSON object matching the schema. No markdown or code blocks.
  header: |
    Required JSON keys: profile (one of {{allowedProfiles}}), rules (array using allowedReasons {{allowedReasons}}), reasoning (<= {{maxSentences}} sentences), optional popularityTier (low|mid|high) ONLY when popularityTierPolicy.allow is true. Do not include other keys.
  constraints: |
    Grounding: reasoning must reference input fields (criticScore + criticScoreSource, popularity.primarySource/primaryScore/primaryVotes/rawPopularity, metacriticScore, rtAudienceScore, rtCriticScore, genres, currentQuality, mediaInfo, lowq, thresholds, signalSummary). If signals are missing or weak, choose the safer lower profile and say "limited signal". Use reasonDescriptions to pick rule(s). Avoid claims about current trends or unseen formats.
  inputs: |
    Input JSON includes title, year, genres, runtime, criticScore, criticScoreSource, popularity {primarySource, primaryScore, primaryVotes, tmdbScore, tmdbVotes, imdbScore, imdbVotes, rawPopularity}, metacriticScore, rtAudienceScore, rtAudienceVotes, rtCriticScore, rtCriticVotes, currentQuality, mediaInfo, lowq, thresholds, visualGenresHigh, signalSummary, policies, hints, popularityTierPolicy.allow. Base all decisions only on these fields; if data is missing or weak, choose the safer lower profile.
  popularityTierPolicy: |
    If popularityTierPolicy.allow is true, set popularityTier to low|mid|high using timeless popularity inference. If false, omit popularityTier entirely.
  groupsAndGenres: |
    Visual genres with high payoff: {{visualGenresHigh}}.

# yaml-language-server: $schema=https://raw.githubusercontent.com/recyclarr/recyclarr/master/schemas/config-schema.json
# ============================================================
# Sonarr Configuration â€“ Series Quality Policy
# ============================================================
#
# Copy this file to data/recyclarr/config/configs/sonarr.yml
#
# Philosophy:
# - Size-based rejection (Remux/HDTV blocked via tiny size caps)
# - Streaming service scoring (ATVP > AMZN/NF > others)
# - Release group tiers (WEB Tier 01/02/03)
# - Light LQ penalty (allows fallback when nothing else available)
# - Custom size limits (not TRaSH defaults)
#
# Note: Sonarr uses SPACES in quality group names (WEB 1080p not WEB-1080p)
# ============================================================

sonarr:
  sonarr_main:
    base_url: !secret sonarr_url
    api_key: !secret sonarr_api_key

    # ------------------------------------------------------
    # Quality definitions (MB per minute)
    # ------------------------------------------------------
    quality_definition:
      type: series
      qualities:
        # Blocked (deterministic reject)
        - { name: HDTV-720p,          min: 0, preferred: 1, max: 1 }
        - { name: HDTV-1080p,         min: 0, preferred: 1, max: 1 }
        - { name: HDTV-2160p,         min: 0, preferred: 1, max: 1 }
        - { name: Bluray-1080p Remux, min: 0, preferred: 1, max: 1 }
        - { name: Bluray-2160p Remux, min: 0, preferred: 1, max: 1 }

        # 720p fallback
        - { name: WEBDL-720p,  min: 6,  preferred: 12,  max: 22 }
        - { name: WEBRip-720p, min: 5,  preferred: 10,  max: 20 }
        - { name: Bluray-720p, min: 10, preferred: 18,  max: 32 }

        # 1080p (increased to allow quality WEB-DLs)
        - { name: WEBDL-1080p,  min: 12, preferred: 30,  max: 55 }
        - { name: WEBRip-1080p, min: 8,  preferred: 22,  max: 45 }
        - { name: Bluray-1080p, min: 18, preferred: 40,  max: 75 }

        # 2160p / 4K
        - { name: WEBDL-2160p,  min: 25, preferred: 70,  max: 130 }
        - { name: WEBRip-2160p, min: 20, preferred: 55,  max: 110 }
        - { name: Bluray-2160p, min: 45, preferred: 100, max: 170 }

    # ------------------------------------------------------
    # Quality Profiles
    # ------------------------------------------------------
    quality_profiles:
      # Note: until_quality is required even when upgrades are disabled
      - name: AutoAssignQuality
        reset_unmatched_scores: { enabled: false }
        upgrade: { allowed: false, until_quality: HDTV-720p }
        quality_sort: top
        qualities:
          - { name: HDTV-720p, enabled: true }
          - { name: HDTV-1080p, enabled: false }
          - { name: HDTV-2160p, enabled: false }
          - { name: Bluray-2160p Remux, enabled: false }
          - { name: Bluray-1080p Remux, enabled: false }
          - { name: WEB 2160p, enabled: false, qualities: [WEBDL-2160p, WEBRip-2160p] }
          - { name: Bluray-2160p, enabled: false }
          - { name: WEB 1080p, enabled: false, qualities: [WEBDL-1080p, WEBRip-1080p] }
          - { name: Bluray-1080p, enabled: false }
          - { name: WEB 720p, enabled: false, qualities: [WEBDL-720p, WEBRip-720p] }
          - { name: Bluray-720p, enabled: false }

      - name: HD
        reset_unmatched_scores: { enabled: true }
        upgrade: { allowed: true, until_quality: WEB 1080p, until_score: 60 }
        min_format_score: 15
        min_upgrade_format_score: 35
        quality_sort: top
        qualities:
          - { name: Bluray-2160p Remux, enabled: false }
          - { name: Bluray-1080p Remux, enabled: false }
          - { name: HDTV-2160p, enabled: false }
          - { name: HDTV-1080p, enabled: false }
          - { name: HDTV-720p, enabled: false }
          - { name: WEB 2160p, enabled: false, qualities: [WEBDL-2160p, WEBRip-2160p] }
          - { name: Bluray-2160p, enabled: false }
          - { name: WEB 1080p, enabled: true, qualities: [WEBDL-1080p, WEBRip-1080p] }
          - { name: Bluray-1080p, enabled: true }
          - { name: WEB 720p, enabled: false, qualities: [WEBDL-720p, WEBRip-720p] }
          - { name: Bluray-720p, enabled: false }

      - name: Efficient-4K
        reset_unmatched_scores: { enabled: true }
        upgrade: { allowed: true, until_quality: WEB 2160p, until_score: 70 }
        min_format_score: 25
        min_upgrade_format_score: 45
        quality_sort: top
        qualities:
          - { name: Bluray-2160p Remux, enabled: false }
          - { name: Bluray-1080p Remux, enabled: false }
          - { name: HDTV-2160p, enabled: false }
          - { name: HDTV-1080p, enabled: false }
          - { name: HDTV-720p, enabled: false }
          - { name: WEB 2160p, enabled: true, qualities: [WEBDL-2160p, WEBRip-2160p] }
          - { name: Bluray-2160p, enabled: false }
          - { name: WEB 1080p, enabled: false, qualities: [WEBDL-1080p, WEBRip-1080p] }
          - { name: Bluray-1080p, enabled: false }
          - { name: WEB 720p, enabled: false, qualities: [WEBDL-720p, WEBRip-720p] }
          - { name: Bluray-720p, enabled: false }

      - name: HighQuality-4K
        reset_unmatched_scores: { enabled: true }
        upgrade: { allowed: true, until_quality: Bluray-2160p, until_score: 80 }
        min_format_score: 20
        min_upgrade_format_score: 40
        quality_sort: top
        qualities:
          - { name: Bluray-2160p Remux, enabled: false }
          - { name: Bluray-1080p Remux, enabled: false }
          - { name: HDTV-2160p, enabled: false }
          - { name: HDTV-1080p, enabled: false }
          - { name: HDTV-720p, enabled: false }
          - { name: Bluray-2160p, enabled: true }
          - { name: WEB 2160p, enabled: true, qualities: [WEBDL-2160p, WEBRip-2160p] }
          - { name: WEB 1080p, enabled: false, qualities: [WEBDL-1080p, WEBRip-1080p] }
          - { name: Bluray-1080p, enabled: false }
          - { name: WEB 720p, enabled: false, qualities: [WEBDL-720p, WEBRip-720p] }
          - { name: Bluray-720p, enabled: false }

    # ------------------------------------------------------
    # Custom Formats (Sonarr-specific TRaSH IDs)
    # ------------------------------------------------------
    custom_formats:
      # Video encode quality
      - trash_ids: [b2550eb333d27b75833e25b8c2557b38] # 10bit
        assign_scores_to:
          - { name: HD, score: 30 }
          - { name: Efficient-4K, score: 35 }
          - { name: HighQuality-4K, score: 40 }

      - trash_ids: [c9eafd50846d299b862ca9bb6ea91950] # x265
        assign_scores_to:
          - { name: HD, score: 25 }
          - { name: Efficient-4K, score: 30 }
          - { name: HighQuality-4K, score: 30 }

      - trash_ids: [cddfb4e32db826151d97352b8e37c648] # x264
        assign_scores_to:
          - { name: HD, score: -10 }
          - { name: Efficient-4K, score: -25 }
          - { name: HighQuality-4K, score: -30 }

      # Release hygiene
      - trash_ids: [ec8fa7296b64e8cd390a1600981f3923] # Repack/Proper
        assign_scores_to:
          - { name: HD, score: 50 }
          - { name: Efficient-4K, score: 50 }
          - { name: HighQuality-4K, score: 50 }

      - trash_ids: [eb3d5cc0a2be0db205fb823640db6a3c] # Repack2
        assign_scores_to:
          - { name: HD, score: 6 }
          - { name: Efficient-4K, score: 6 }
          - { name: HighQuality-4K, score: 6 }

      - trash_ids: [44e7c4de10ae50265753082e5dc76047] # Repack3
        assign_scores_to:
          - { name: HD, score: 7 }
          - { name: Efficient-4K, score: 7 }
          - { name: HighQuality-4K, score: 7 }

      # Scene releases (mild penalty - not hard reject)
      - trash_ids: [1b3994c551cbb92a2c781af061f4ab44] # Scene
        assign_scores_to:
          - { name: HD, score: -15 }
          - { name: Efficient-4K, score: -15 }
          - { name: HighQuality-4K, score: -20 }

      # ------------------------------------------------------
      # Streaming Services (tiered by quality reputation)
      # ------------------------------------------------------
      # Tier 1: Highest quality (Apple TV+)
      - trash_ids:
          - f67c9ca88f463a48346062e8ad07713f # ATVP (Apple TV+)
        assign_scores_to:
          - { name: HD, score: 25 }
          - { name: Efficient-4K, score: 30 }
          - { name: HighQuality-4K, score: 35 }

      # Tier 2: Premium quality
      - trash_ids:
          - d660701077794679fd59e8bdf4ce3a29 # AMZN
          - 89358767a60cc28783cdc3d0be9388a4 # DSNP (Disney+)
          - a880d6abc21e7c16884f3ae393f84179 # HMAX (HBO Max)
          - d34870697c9db575f17700212167be23 # NF (Netflix)
        assign_scores_to:
          - { name: HD, score: 18 }
          - { name: Efficient-4K, score: 22 }
          - { name: HighQuality-4K, score: 25 }

      # Tier 3: Good quality
      - trash_ids:
          - c67a75ae4a1715f2bb4d492755ba4195 # PMTP (Paramount+)
          - 1656adc6d7bb2c8cca6acfb6592db421 # PCOK (Peacock)
          - f6cce30f1733d5c8194222a7507909bb # HULU
        assign_scores_to:
          - { name: HD, score: 12 }
          - { name: Efficient-4K, score: 15 }
          - { name: HighQuality-4K, score: 18 }

      # ------------------------------------------------------
      # Release Groups - WEB Tiers
      # ------------------------------------------------------
      - trash_ids:
          - e6258996055b9fbab7e9cb2f75819294 # WEB Tier 01
        assign_scores_to:
          - { name: HD, score: 25 }
          - { name: Efficient-4K, score: 30 }
          - { name: HighQuality-4K, score: 35 }

      - trash_ids:
          - 58790d4e2fdcd9733aa7ae68ba2bb503 # WEB Tier 02
        assign_scores_to:
          - { name: HD, score: 18 }
          - { name: Efficient-4K, score: 22 }
          - { name: HighQuality-4K, score: 25 }

      - trash_ids:
          - d84935abd3f8556dcd51d4f27e22d0a6 # WEB Tier 03
        assign_scores_to:
          - { name: HD, score: 12 }
          - { name: Efficient-4K, score: 15 }
          - { name: HighQuality-4K, score: 18 }

      # LQ penalties (light - allows fallback)
      - trash_ids: [9c11cd3f07101cdba90a2d81cf0e56b4] # LQ
        assign_scores_to:
          - { name: HD, score: -10 }
          - { name: Efficient-4K, score: 0 }
          - { name: HighQuality-4K, score: -15 }

      - trash_ids: [e2315f990da2e2cbfc9fa5b7a6fcfe48] # LQ (Release Title)
        assign_scores_to:
          - { name: HD, score: -10 }
          - { name: Efficient-4K, score: 0 }
          - { name: HighQuality-4K, score: -15 }

# Save this to data/quality-broker/config/config.yaml
batchSize: 10
autoAssignProfile: AutoAssignQuality
# Optional: set to a profile name to re-evaluate all movies in that profile.
# Leave empty to only process AutoAssignQuality queue.
reviseQualityForProfile: ""
decisionProfiles:
  - HD
  - Efficient-4K
  - HighQuality-4K

radarr:
  # URL auto-derives from LAN_HOSTNAME/RADARR_PORT (or radarr:7878 in Docker);
  # set this field only if you need a custom host.
  # url:
  apiKey: your-radarr-api-key

openai:
  apiKey: your-openai-api-key
  # Default: gpt-4.1 (supports json_schema structured outputs for stricter validation).
  # Rationale: maximize schema compliance and reduce malformed responses.
  model: gpt-4.1
  # Default: 0.15
  # Rationale: keep decisions consistent and grounded; higher values increase variance.
  temperature: 0.15
  # Default: 320
  # Rationale: enough for concise reasoning without encouraging verbosity.
  maxTokens: 320


thresholds:
  criticScoreMin: 68
  popularityHigh: 80
  popularityLow: 10
  allowPopularityTierFallback: true
  popularityTierFallbackMaxPopularity: 2

visualGenresHigh:
  - Action
  - Animation
  - Adventure
  - Sci-Fi
  - Fantasy
  - War
  - Thriller

policies:
  reasoning:
    maxSentences: 2
    forbidCurrentTrendsClaims: true
    allowTimelessCulturalInference: true

promptHints: |
  - Use only the provided fields and thresholds. Do not claim recency, trends, or external buzz.
  - Treat raw popularity as noisy; prefer computedPopularityIndex when available.
  - Do not infer anything beyond criticScore, popularity, genre, and visual richness signals.
  - A Visually rich film is one that has visualGenresHigh or a combination of these genres or where HDR/DV adds value.
  
  - If criticScore >= 76:
      Choose HighQuality-4K (override all other signals).

  - If criticScore is between 70 and 76 (inclusive):
      Default to HighQuality-4K 
      Lower to Efficient-4K only if NO strong popularity and/or NO clear visual-richness signals exist.

  - If criticScore is between 65 and 76 (inclusive):
      Choose Efficient-4K only when popularity is reasonably high and strong popularity is met.
      Otherwise, choose HD.

  - If criticScore <= 60:
      Never choose HighQuality-4K, even if visually rich.
      Prefer HD unless other signals strongly justify Efficient-4K.

  - Visual richness rule:
      If a film is visually rich (visualGenresHigh, cinematography, VFX, HDR/DV benefit),
      Prefer HighQuality-4K unless blocked by low criticScore (<=60)
      If blocked by low criticScore (<=60) then choose Efficient-4K only if visualGenresHigh has intense Action, War - fast moving sequences.

  - Profile intent summary:
      - HighQuality-4K: top-tier critical reception or visually rich prestige titles.
      - Efficient-4K: 4K-worthy films with solid but not exceptional signals.
      - HD: low-signal, low-score, or utility titles where 4K adds little value.

reasonTags:
  popular: when upgrade reason is that film is popular / culturally significant
  criticScore: when upgrade reason is that film has a good critic score
  visual: when upgrade reason is that film is visually rich (action, animation, HDR/DV value)
  lowq: when current file quality is 720p or below
  met: when current file meets quality demands based on rules

promptTemplate:
  prelude: |
    You are a Radarr quality profile decision agent. Respond ONLY with a single JSON object matching the schema. No markdown or code blocks.
  header: |
    Return keys: profile (one of {{allowedProfiles}}), rules (array using allowedReasons {{allowedReasons}}), reasoning (<= {{maxSentences}} sentences). Include popularityTier (low|mid|high) ONLY when popularityTierPolicy.allow is true. Do not include other keys.
  constraints: |
    Ground reasoning in provided fields/values (criticScore + criticScoreSource, popularity.primarySource/primaryScore/primaryVotes/computedPopularityIndex/rawPopularity, metacriticScore, rtAudienceScore, rtCriticScore, genres, currentQuality, mediaInfo, lowq, signalSummary). If signals are missing or weak, choose the safer lower profile and say "limited signal". Use reasonDescriptions to pick rule(s). Avoid claims about current trends or unseen formats.
  inputs: |
    Input JSON includes title, year, genres, runtime, criticScore, criticScoreSource, popularity {primarySource, primaryScore, primaryVotes, tmdbScore, tmdbVotes, imdbScore, imdbVotes, computedPopularityIndex, rawPopularity}, metacriticScore, rtAudienceScore, rtAudienceVotes, rtCriticScore, rtCriticVotes, currentQuality, mediaInfo, lowq, thresholds, visualGenresHigh, signalSummary, policies, hints, popularityTierPolicy.allow. Base decisions only on these fields; if data is missing or weak, choose the safer lower profile.
  popularityTierPolicy: |
    If popularityTierPolicy.allow is true, set popularityTier to low|mid|high using timeless popularity inference only. If false, omit popularityTier entirely.
  groupsAndGenres: |
    Visual genres with high payoff: {{visualGenresHigh}}.
